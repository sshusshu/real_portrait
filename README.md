# Line portrait 

### face APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ë¬¼ì‚¬ì§„ ì—…ë¡œë“œ ì‹œ ì–¼êµ´ì˜ ì£¼ìš” í¬ì¸íŠ¸ ì¢Œí‘œë¥¼ ì–»ì–´ svg ë¼ì¸ ë“œë¡œì‰ìœ¼ë¡œ í‘œí˜„

* face api ì •ë³´ í™œìš©
* ë¼ì¸ ë“œë¡œì‰ êµ¬í˜„
* ë‹¤ìš´ë¡œë“œ ë° sns ê³µìœ  êµ¬í˜„  
* ë°©ëª…ë¡ ê¸°ëŠ¥ êµ¬í˜„

_Keyword : React JS / SVG / NEXT JS / EXPRESS / WEBPACK_
   
<img src="https://img.shields.io/badge/-html5-E34F26?style=flat&logo=html5&logoColor=00c8ff"> <img src="https://img.shields.io/badge/-Sass-cc6699?style=flat&logo=sass&logoColor=ffffff"> <img src="https://img.shields.io/badge/-JavaScript-eed718?style=flat&logo=javascript&logoColor=ffffff"> <img src="https://img.shields.io/badge/-React-000000?style=flat&logo=react&logoColor=00c8ff">  

> ë¼ì¸ ë“œë¡œì‰ì„ ê·¸ë ¤ì£¼ëŠ” ì–´í”Œì„ ë§Œë“¤ì–´ ë³´ê³  ì‹¶ì–´ ê¸°íš, ë””ìì¸, ê°œë°œ
> 
> face API ìë°”ìŠ¤í¬ë¦½íŠ¸ ë²„ì „ì„ ì‚¬ìš©   
> 
> ë¦¬ì•¡íŠ¸ í•™ìŠµì„ ìœ„í•´ ë¦¬ì•¡íŠ¸ë¡œ ì œì‘
>
> ì„œë²„ í†µì‹  í•™ìŠµì„ ìœ„í•´ EXPRESS ì‚¬ìš©

---

## ğŸ”³ ì½”ë“œêµ¬ì„±  

### âœ”ï¸ ì‚¬ì§„ ì—…ë¡œë“œ ì‹œ FACE APIë¥¼ í†µí•´ ì–¼êµ´ ì¢Œí‘œë¥¼ ì–»ì–´ SVGë¡œ ê·¸ë ¤ì¤Œ ì´ ì™¸ì— ë‹¤ìš´ë¡œë“œ, SNS ê³µìœ , ë°©ëª…ë¡ êµ¬í˜„

####  ë“œë¡œì‰:  
- Drawing ì»´í¬ë„ŒíŠ¸ ë‚´ì— drawing box ë‚´ì— svgë¥¼ ìƒì„±í•˜ëŠ” ë°©ì‹

####  ë°©ëª…ë¡:  
- MsgBox ì»´í¬ë„ŒíŠ¸ ë‚´ì— MsgInput ê³¼ MsgList ë¡œ êµ¬ì„±

####  ë‹¤ìš´ë¡œë“œ, sns ê³µìœ :  
- BtnBox ì»´í¬ë„ŒíŠ¸ ë‚´ì— ë‹¤ìš´ë¡œë“œ, ê³µìœ  buttonìœ¼ë¡œ ì¡°ì‘í•˜ëŠ” ë°©ì‹  
    
### âœ”ï¸ ì£¼ìš” ì´ë²¤íŠ¸

1. ì‚¬ì§„ ì—…ë¡œë“œ : ì—…ë¡œë“œ í•œ ì‚¬ì§„ì„ ì ë‹¹í•œ í¬ê¸°ë¡œ í¬ë¡­ í›„ face APIë¥¼ ì´ìš©í•˜ì—¬ ì¢Œí‘œë¥¼ ì°¾ê³  SVGë¡œ ë“œë¡œì‰ 
2. ë°©ëª…ë¡ ì‘ì„± : ë°©ëª…ë¡ ì½ê¸°, ì‘ì„±, ìˆ˜ì •, ì‚­ì œë¥¼ í†µí•´ CRUD êµ¬í˜„ 
3. ë‹¤ìš´ë¡œë“œ, ê³µìœ  : ë“œë¡œì‰ì„ ë‹¤ìš´ë¡œë“œ í•˜ê³  snsì— ê³µìœ 


### âœ”ï¸ ì´ë²¤íŠ¸ í›„ ê³¼ì •:

- ì‚¬ì§„ ì—…ë¡œë“œ í›„ ë“œë¡œì‰
  - ì—…ë¡œë“œ í•œ ì‚¬ì§„ì„ ì ë‹¹í•œ í¬ê¸°ë¡œ í¬ë¡­ í›„ face APIë¥¼ ì´ìš©í•˜ì—¬ ì¢Œí‘œë¥¼ ì°¾ê³  SVGë¡œ ë“œë¡œì‰ 
      1. onUpload (ì‚¬ì§„ ì—…ë¡œë“œ) : input fileë¡œ ì—…ë¡œë“œ í•œ ì‚¬ì§„ì„ ì €ì¥
      2. resizedImg (ì–¼êµ´ì´ ìˆìœ¼ë©´ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•) : ì–¼êµ´ ì¢Œí‘œ ìµœì†Œx,y ì™€ ìµœëŒ€ x,yë¥¼ ê¸°ì¤€ìœ¼ë¡œ í¬ë¡­ í›„ ìº”ë²„ìŠ¤ì— ê·¸ë ¤ì¤Œ(drawingCvs)
         setIsNothing (ì–¼êµ´ì´ ì—†ìœ¼ë©´ ë‹¤ì‹œ ì—…ë¡œë“œ ë¬¸êµ¬)
      3. landmarks (ì–¼êµ´ ì£¼ìš”ë¶€ìœ„ ì¢Œí‘œ ì°¾ê¸°) : face APIë¡œ ì–¼êµ´ ì¢Œí‘œ ê²€ìƒ‰
      4. customPoints (ì´ë§ˆì™€ í—¤ì–´ë¼ì¸ ì¢Œí‘œ ì°¾ê¸°) : í”½ì…€ ì¹¼ë¼ê°’ì˜ ì°¨ì´ ìˆœìœ¼ë¡œ ì¢Œí‘œ ê²€ìƒ‰
      5. drawingFace (svgë¡œ ì–¼êµ´ ê·¸ë¦¬ê¸°) : ê²€ìƒ‰í•œ ì¢Œí‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ SVG data ì¡°ì‘ í›„ ì—…ë¡œë“œ
      
    
- ë°©ëª…ë¡
  - ë°©ëª…ë¡ ì½ê¸°, ì‘ì„±, ìˆ˜ì •, ì‚­ì œë¥¼ í†µí•´ CRUD êµ¬í˜„ 
     - expressë¥¼ ì´ìš©í•œ ê°„ë‹¨í•œ JSON DB êµ¬ì¶•
     - REST APIë¡œ ë°ì´í„° í†µì‹ 
  
- ë‹¤ìš´ë¡œë“œ ë° SNS ê³µìœ 
   - ë‹¤ìš´ë¡œë“œ 
      - saveDrawing (ë“œë¡œì‰ ë‹¤ìš´ë¡œë“œ) : ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ svgDataë¥¼ Blob í˜•íƒœë¡œ ê°€ê³µ í›„ URLì„ ë§Œë“¤ê³  ë‹¤ìš´ë¡œë“œ
   - SNS ê³µìœ 
      - onShareCreate (ë“œë¡œì‰ì„ ë‹´ì€ url ìƒì„±) í›„ ê° SNSë³„ ê³µìœ  ì£¼ì†Œì— í•´ë‹¹ URL ì „ë‹¬ 


---


## ğŸ”³ ì£¼ìš” ì´ìŠˆ ì‚¬í•­

1. ì—…ë¡œë“œ í•œ ì‚¬ì§„ì—ì„œ ì¢Œí‘œ ê²€ìƒ‰ ì‹œ
  - ë¬¸ì œ ì‚¬í•­
    - ì—…ë¡œë“œí•˜ëŠ” ì‚¬ì§„ì˜ í¬ê¸°, ê·¸ ì•ˆì˜ ì–¼êµ´ í¬ê¸°ê°€ ëª¨ë‘ ë‹¬ë¼ì„œ ì¼ì •í•œ ë“œë¡œì‰ì„ í‘œí˜„í•˜ê¸°ê°€ ì–´ë ¤ì›€
  - ë¬¸ì œ í•´ê²° ë°©ë²•
    - ì´ë¯¸ì§€ í¬ê¸° í†µì¼ í•„ìš” 
    - ì‚¬ì§„ ì•ˆì˜ ì–¼êµ´ì„ í¬ë¡­í•˜ì—¬ ë‹¤ì‹œ ìº”ë²„ìŠ¤ì— ë™ì¼í•œ í¬ê¸°ë¡œ ê·¸ë ¤ì¤€ í›„ ì§„í–‰ 	 
      
2. ì´ë§ˆì™€ ë¨¸ë¦¬ ì¢Œí‘œ ê²€ìƒ‰ ì‹œ
  - ë¬¸ì œ ì‚¬í•­ 
    - face apiëŠ” ì´ë§ˆì™€ ë¨¸ë¦¬ ì¢Œí‘œë¥¼ ì œê³µí•˜ì§€ ì•ŠìŒ
  - ë¬¸ì œ í•´ê²° ë°©ë²•
    - ì´ë§ˆì¢Œí‘œ ì°¾ê¸° ì§‘ì  êµ¬í˜„  
      ìº”ë²„ìŠ¤ ì´ë¯¸ì§€ ì´ì°¨ì› ë°°ì—´ì—ì„œ í”½ì…€ë³„ ê²€ìƒ‰  
      ëˆˆì¹ê³¼ ê´€ìë†€ì´ ì½”ë“±ì˜ ì¢Œí‘œ x, yê°’ì„ ë°›ì•„ ìœ„ë¡œ yì¢Œí‘œë“¤ë§Œì„ ê²€ìƒ‰í•˜ì—¬ ë¶ˆí•„ìš”í•œ ê²€ìƒ‰ ìµœì†Œí™”  
      ì•„ë˜ í”½ì…€ ì¹¼ë¼ê°’ê³¼ ê°€ì¥ ë§ì€ ì°¨ì´ê°€ ë‚˜ëŠ” í¬ì¸íŠ¸ë¥¼ ì¢Œí‘œë¡œ customPointsì— ê°ì²´í˜•íƒœë¡œ ì €ì¥  

    - í—¤ì–´ ì¢Œí‘œ ì°¾ê¸° ì§ì ‘ êµ¬í˜„(ì´ë§ˆì¢Œí‘œì™€ ë¹„ìŠ·í•œ ë°©ë²•ìœ¼ë¡œ êµ¬í˜„)  
      ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë²•ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì‚¬ì§„ë§ˆë‹¤ í¸ì°¨ê°€ ì¡´ì¬í•˜ê³  ê°€ë” ì˜¤ë¥˜ê°€ ë°œìƒ
      => ì•ìœ¼ë¡œ ì°¨ê·¼íˆ ê³ ì³ë‚˜ê°ˆ ê³„íš

3. ì–¼êµ´ í¬ê¸° í†µì¼ ì‹œ 
  - ë¬¸ì œ ì‚¬í•­
      - í¬ë¡­ ì†Œìš” ì‹œê°„ì´ ê¹€ 
      - ìµœì†Œ xy, ìµœëŒ€ xy êµ¬í•  ë•Œ, mapê³¼ math.min, math.maxë¡œ 6ë²ˆ ë°˜ë³µë¬¸ ì‚¬ìš©
  - ë¬¸ì œ í•´ê²° ë°©ë²•
     - array[idx]ë¡œ ë°”ë¡œ ì ‘ê·¼ ë°©ë²•ìœ¼ë¡œ ìˆ˜ì • 
 
  
---

## ğŸ”³ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš´ì 

> - ë¦¬ì•¡íŠ¸ì— ëŒ€í•œ ì´í•´
> - ì„œë²„ í†µì‹ 
> - ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°
> - ì™¸ë¶€ API ì‚¬ìš©ë²•

---

## ğŸ”³ ì„œë²„ í†µì‹ 
JSON DB êµ¬ì¶•  
Node JS ê¸°ë°˜ì˜ express ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©  
ê°„ë‹¨í•œ REST APIë¥¼ ì§ì ‘ êµ¬í˜„

````js


const messagesRoute = [{
 // CREATE MESSAGE
    method: 'post',
    route: '/messages',
    handler: ({ body }, res) => {
      const msgs = getMsgs()
      const newMsg = {
        text: body.text,
        userId: body.userId,
        timestamp: Date.now(),
      }
      msgs.unshift(newMsg)
      setMsgs(msgs)
      res.send(newMsg)
    },
}]
````

````js
import express from 'express';

const app = express();
app.use(express.urlencoded({ extended: true }));
app.use(express.json());

app.use(
  cors({
    origin: 'http://localhost:3000',
    credentials: true,
  }),
)


//app[messagesRoute[0].method](messageRoute[0].route,messageRoute[0].handler)

const routes = [...messagesRoute, ...usersRoute, ...drawingsRoute]
routes.forEach(({ method, route, handler }) => {
   app[method](route, handler);
})


app.listen(8000, () => {
  console.log('server listening on 8000...')
})

````



## ğŸ”³ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°
async, await, promiseë¥¼ í™œìš©í•˜ì—¬ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë° êµ¬í˜„  
  
    
    
* face APIì—ì„œ í•„ìš”í•œ 2ê°œë¥¼ promise.allë¡œ ê°€ì ¸ì˜¨ í›„ ì‹œì‘
````js
 const loadModels = async()=>{
   const MODEL_URL = './models';
   Promise.all([
     faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL),
     faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
   ])
 }
````
    
    
* face APIì—ì„œ ì–¼êµ´ì„ ì¢Œí‘œë¥¼ ì°¾ì€ í›„ points ì •ì˜
````js
 async function landmarks(faceapi){
     detecting = await faceapi
         .detectSingleFace(canvas.current)
         .withFaceLandmarks()
     points = detecting.landmarks.positions;
 }
````
  
  
* ì´ë¯¸ì§€ë¥¼ ë°›ê³  í•˜ë‚˜ì˜ ì–¼êµ´ì— ì¢Œí‘œë¥¼ ê²€ìƒ‰ í›„ ë¦¬ì‚¬ì´ì§•
````js
 async function resizedImg(faceapi,file){
     const image = await faceapi.bufferToImage(file.files[0]);
     const detect = await faceapi.detectSingleFace(image).withFaceLandmarks();
     const point = detect.landmarks.positions;
     const sx = point[0]._x-50;
     const sy = point[19]._y-200;
     const ex = point[16]._x+50;
     const ey = point[8]._y+20;
     mw = 350;
     mh = (mw*(ey-sy))/(ex-sx);
     setCvsW(mw);
     setCvsH(mh);
     context.drawImage(image,sx,sy,ex-sx,ey-sy,0,0,mw,mh);
}

````

* ë¹„ë™ê¸° í•¨ìˆ˜ì™€ ë™ê¸° í•¨ìˆ˜ë¥¼ ì°¨ë¡€ëŒ€ë¡œ ì‹¤í–‰
````js
async function drawStart(){     
   setIsLoading(true);
   try{
       await resizedImg(faceapi,file);
       await landmarks(faceapi);
       setIsDone(true)
   }catch(e){
       setIsLoading(false);
       setIsNothing(true);
       setIsDone(false);
       return;
   }
   setIsLoading(false);
   drawingCvs(points,context);
   drawingFace(drawBox,points,mw,mh,customPoints);
   saveDrawing(drawBox.children[0]);
}
````



---

## Getting Started

1.  Clone the repo:

        git clone https://github.com/sshusshu/real_portrait.git

2.  Install dependencies:

        npm install
